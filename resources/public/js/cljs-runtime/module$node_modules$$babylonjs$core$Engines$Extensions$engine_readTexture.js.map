{
"version":3,
"file":"module$node_modules$$babylonjs$core$Engines$Extensions$engine_readTexture.js",
"lineCount":7,
"mappings":"AAAAA,cAAA,CAAA,yEAAA,CAA8F,QAAQ,CAACC,MAAD,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAAgC,CAkBtIC,QAASA,2BAA0B,CAACC,IAAD,CAAOC,eAAP,CAAwBC,WAAA,CAAc,CAAA,CAAtC,CAA6CC,UAA7C,CAAyD,CAC1F,OAAQH,IAAR,EACE,KAAK,CAAL,CAQI,MANMI,KAMCA,CANiD,IAAIC,SAAJ,CAAcJ,eAAd,CAMjDG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAID,SAAJ,CAAcF,UAAd,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CAQI,MANMA,KAMCA,CANiD,IAAIG,UAAJ,CAAeN,eAAf,CAMjDG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAIC,UAAJ,CAAeJ,UAAf,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CAQI,MANMA,KAMCA,CANQH,eAAA,WAA2BO,YAA3B,CAAyC,IAAIC,UAAJ,CAAeR,eAAf,CAAzC;AAA2E,IAAIQ,UAAJ,CAAeP,WAAA,CAAcD,eAAd,CAAgC,CAAhC,CAAoCA,eAAnD,CAMnFG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAIG,UAAJ,CAAeN,UAAf,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CACA,KAAK,CAAL,CACA,KAAK,CAAL,CACA,KAAK,EAAL,CACA,KAAK,CAAL,CAQI,MANMA,KAMCA,CANQH,eAAA,WAA2BO,YAA3B,CAAyC,IAAIE,WAAJ,CAAgBT,eAAhB,CAAzC,CAA4E,IAAIS,WAAJ,CAAgBR,WAAA,CAAcD,eAAd,CAAgC,CAAhC,CAAoCA,eAApD,CAMpFG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAII,WAAJ,CAAgBP,UAAhB,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CAQI,MANMA,KAMCA,CANQH,eAAA,WAA2BO,YAA3B,CAAyC,IAAIG,UAAJ,CAAeV,eAAf,CAAzC,CAA2E,IAAIU,UAAJ,CAAeT,WAAA,CAAcD,eAAd,CAAgC,CAAhC,CAAoCA,eAAnD,CAMnFG;AAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAIK,UAAJ,CAAeR,UAAf,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CACA,KAAK,EAAL,CACA,KAAK,EAAL,CACA,KAAK,EAAL,CACA,KAAK,EAAL,CACA,KAAK,EAAL,CAQI,MANMA,KAMCA,CANQH,eAAA,WAA2BO,YAA3B,CAAyC,IAAII,WAAJ,CAAgBX,eAAhB,CAAzC,CAA4E,IAAIW,WAAJ,CAAgBV,WAAA,CAAcD,eAAd,CAAgC,CAAhC,CAAoCA,eAApD,CAMpFG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAIM,WAAJ,CAAgBT,UAAhB,CAAX,CAGKC,CAAAA,IAGX,MAAK,CAAL,CAQI,MANMA,KAMCA,CANQH,eAAA,WAA2BO,YAA3B,CAAyC,IAAIK,YAAJ,CAAiBZ,eAAjB,CAAzC,CAA6E,IAAIY,YAAJ,CAAiBX,WAAA,CAAcD,eAAd,CAAgC,CAAhC,CAAoCA,eAArD,CAMrFG,CAJHD,UAIGC,EAHLA,IAAOE,CAAAA,GAAP,CAAW,IAAIO,YAAJ,CAAiBV,UAAjB,CAAX,CAGKC;AAAAA,IApFb,CAwFMA,IAAAA,CAAkD,IAAIG,UAAJ,CAAeN,eAAf,CAEpDE,WAAJ,EACEC,IAAOE,CAAAA,GAAP,CAAW,IAAIC,UAAJ,CAAeJ,UAAf,CAAX,CAGF,OAAOC,KA/FmF,CAf5FU,MAAOC,CAAAA,cAAP,CAAsBjB,OAAtB,CAA+B,YAA/B,CAA6C,CAC3CkB,MAAO,CAAA,CADoC,CAA7C,CAGAlB,QAAQC,CAAAA,0BAAR,CAAqCA,0BAEjCkB,OAAAA,CAAcrB,OAAA,CAAQ,wDAAR,CA4GlBqB,OAAYC,CAAAA,UAAWC,CAAAA,SAAUC,CAAAA,sBAAjC,CAA0DC,QAAS,CAACC,OAAD,CAAUC,KAAV,CAAiBC,MAAjB,CAAyBC,SAAA,CAAY,CAAC,CAAtC,CAAyCC,KAAA,CAAQ,CAAjD,CAAoDtB,MAAA,CAAS,IAA7D,CAAmEuB,aAAA,CAAgB,CAAA,CAAnF,CAAyFC,gBAAA,CAAmB,CAAA,CAA5G,CAAmHC,CAAA,CAAI,CAAvH,CAA0HC,CAAA,CAAI,CAA9H,CAAiI,CAAA,IAC9LC,EAD8L,CAC1LC,EAER,OAAMC,GAAK,IAAKC,CAAAA,GAEhB,IAAI,CAACD,EAAL,CACE,KAAUE,MAAJ,CAAU,4CAAV,CAAN;AAGF,GAAI,CAAC,IAAKC,CAAAA,iBAAV,CAA6B,CAC3B,MAAMC,MAAQJ,EAAGK,CAAAA,iBAAH,EAEd,IAAI,CAACD,KAAL,CACE,KAAUF,MAAJ,CAAU,oCAAV,CAAN,CAGF,IAAKC,CAAAA,iBAAL,CAAyBC,KAPE,CAU7BJ,EAAGM,CAAAA,eAAH,CAAmBN,EAAGO,CAAAA,WAAtB,CAAmC,IAAKJ,CAAAA,iBAAxC,CAEgB,EAAC,CAAjB,CAAIX,SAAJ,CACEQ,EAAGQ,CAAAA,oBAAH,CAAwBR,EAAGO,CAAAA,WAA3B,CAAwCP,EAAGS,CAAAA,iBAA3C,CAA8DT,EAAGU,CAAAA,2BAAjE,CAA+FlB,SAA/F,CAA8I,IAApC,IAACM,EAAD,CAAMT,OAAQsB,CAAAA,gBAAd,GAAmD,IAAK,EAAxD,GAA4Cb,EAA5C,CAA4D,IAAK,EAAjE,CAAqEA,EAAGc,CAAAA,kBAAlL,CAAsMnB,KAAtM,CADF,CAGEO,EAAGQ,CAAAA,oBAAH,CAAwBR,EAAGO,CAAAA,WAA3B,CAAwCP,EAAGS,CAAAA,iBAA3C,CAA8DT,EAAGa,CAAAA,UAAjE,CAAiH,IAApC,IAACd,EAAD,CAAMV,OAAQsB,CAAAA,gBAAd;AAAmD,IAAK,EAAxD,GAA4CZ,EAA5C,CAA4D,IAAK,EAAjE,CAAqEA,EAAGa,CAAAA,kBAArJ,CAAyKnB,KAAzK,CAGEqB,UAAAA,CAA4BC,IAAAA,EAAjB,GAAA1B,OAAQtB,CAAAA,IAAR,CAA6B,IAAKiD,CAAAA,oBAAL,CAA0B3B,OAAQtB,CAAAA,IAAlC,CAA7B,CAAuEiC,EAAGiB,CAAAA,aAEzF,IAAKtB,gBAAL,CAkBYxB,MAAL,GACLA,MADK,CACIL,0BAAA,CAA2BuB,OAAQtB,CAAAA,IAAnC,CAAyC,CAAzC,CAA6CuB,KAA7C,CAAqDC,MAArD,CADJ,CAlBP,KACE,QAAQuB,SAAR,EACE,KAAKd,EAAGiB,CAAAA,aAAR,CACO9C,MAAL,GACEA,MADF,CACW,IAAIG,UAAJ,CAAe,CAAf,CAAmBgB,KAAnB,CAA2BC,MAA3B,CADX,CAIAuB,UAAA,CAAWd,EAAGiB,CAAAA,aACd,MAEF,SACO9C,MAIL,GAHEA,MAGF,CAHW,IAAIS,YAAJ,CAAiB,CAAjB,CAAqBU,KAArB,CAA6BC,MAA7B,CAGX,EAAAuB,SAAA,CAAWd,EAAGkB,CAAAA,KAdlB,CAqBExB,aAAJ,EACE,IAAKyB,CAAAA,gBAAL,EAGFnB,GAAGoB,CAAAA,UAAH,CAAcxB,CAAd,CAAiBC,CAAjB,CAAoBP,KAApB,CAA2BC,MAA3B;AAAmCS,EAAGqB,CAAAA,IAAtC,CAA4CP,SAA5C,CAAsD3C,MAAtD,CACA6B,GAAGM,CAAAA,eAAH,CAAmBN,EAAGO,CAAAA,WAAtB,CAAmC,IAAKe,CAAAA,mBAAxC,CACA,OAAOnD,OAzD2L,CA4DpMa,OAAYC,CAAAA,UAAWC,CAAAA,SAAUqC,CAAAA,kBAAjC,CAAsDC,QAAS,CAACnC,OAAD,CAAUC,KAAV,CAAiBC,MAAjB,CAAyBC,SAAA,CAAY,CAAC,CAAtC,CAAyCC,KAAA,CAAQ,CAAjD,CAAoDtB,MAAA,CAAS,IAA7D,CAAmEuB,aAAA,CAAgB,CAAA,CAAnF,CAAyFC,gBAAA,CAAmB,CAAA,CAA5G,CAAmHC,CAAA,CAAI,CAAvH,CAA0HC,CAAA,CAAI,CAA9H,CAAiI,CAC9L,MAAO4B,QAAQC,CAAAA,OAAR,CAAgB,IAAKvC,CAAAA,sBAAL,CAA4BE,OAA5B,CAAqCC,KAArC,CAA4CC,MAA5C,CAAoDC,SAApD,CAA+DC,KAA/D,CAAsEtB,MAAtE,CAA8EuB,aAA9E,CAA6FC,gBAA7F,CAA+GC,CAA/G,CAAkHC,CAAlH,CAAhB,CADuL,CAhL1D;",
"sources":["node_modules/@babylonjs/core/Engines/Extensions/engine.readTexture.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$babylonjs$core$Engines$Extensions$engine_readTexture\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.allocateAndCopyTypedBuffer = allocateAndCopyTypedBuffer;\n\nvar _thinEngine = require(\"../../Engines/thinEngine.js\");\n\n/**\n * Allocate a typed array depending on a texture type. Optionally can copy existing data in the buffer.\n * @param type type of the texture\n * @param sizeOrDstBuffer size of the array OR an existing buffer that will be used as the destination of the copy (if copyBuffer is provided)\n * @param sizeInBytes true if the size of the array is given in bytes, false if it is the number of elements of the array\n * @param copyBuffer if provided, buffer to copy into the destination buffer (either a newly allocated buffer if sizeOrDstBuffer is a number or use sizeOrDstBuffer as the destination buffer otherwise)\n * @returns the allocated buffer or sizeOrDstBuffer if the latter is an ArrayBuffer\n */\nfunction allocateAndCopyTypedBuffer(type, sizeOrDstBuffer, sizeInBytes = false, copyBuffer) {\n  switch (type) {\n    case 3:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Int8Array(sizeOrDstBuffer) : new Int8Array(sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Int8Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 0:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Uint8Array(sizeOrDstBuffer) : new Uint8Array(sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Uint8Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 4:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Int16Array(sizeOrDstBuffer) : new Int16Array(sizeInBytes ? sizeOrDstBuffer / 2 : sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Int16Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 5:\n    case 8:\n    case 9:\n    case 10:\n    case 2:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Uint16Array(sizeOrDstBuffer) : new Uint16Array(sizeInBytes ? sizeOrDstBuffer / 2 : sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Uint16Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 6:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Int32Array(sizeOrDstBuffer) : new Int32Array(sizeInBytes ? sizeOrDstBuffer / 4 : sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Int32Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 7:\n    case 11:\n    case 12:\n    case 13:\n    case 14:\n    case 15:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Uint32Array(sizeOrDstBuffer) : new Uint32Array(sizeInBytes ? sizeOrDstBuffer / 4 : sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Uint32Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n\n    case 1:\n      {\n        const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Float32Array(sizeOrDstBuffer) : new Float32Array(sizeInBytes ? sizeOrDstBuffer / 4 : sizeOrDstBuffer);\n\n        if (copyBuffer) {\n          buffer.set(new Float32Array(copyBuffer));\n        }\n\n        return buffer;\n      }\n  }\n\n  const buffer = sizeOrDstBuffer instanceof ArrayBuffer ? new Uint8Array(sizeOrDstBuffer) : new Uint8Array(sizeOrDstBuffer);\n\n  if (copyBuffer) {\n    buffer.set(new Uint8Array(copyBuffer));\n  }\n\n  return buffer;\n}\n\n_thinEngine.ThinEngine.prototype._readTexturePixelsSync = function (texture, width, height, faceIndex = -1, level = 0, buffer = null, flushRenderer = true, noDataConversion = false, x = 0, y = 0) {\n  var _a, _b;\n\n  const gl = this._gl;\n\n  if (!gl) {\n    throw new Error(\"Engine does not have gl rendering context.\");\n  }\n\n  if (!this._dummyFramebuffer) {\n    const dummy = gl.createFramebuffer();\n\n    if (!dummy) {\n      throw new Error(\"Unable to create dummy framebuffer\");\n    }\n\n    this._dummyFramebuffer = dummy;\n  }\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this._dummyFramebuffer);\n\n  if (faceIndex > -1) {\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, (_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource, level);\n  } else {\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, (_b = texture._hardwareTexture) === null || _b === void 0 ? void 0 : _b.underlyingResource, level);\n  }\n\n  let readType = texture.type !== undefined ? this._getWebGLTextureType(texture.type) : gl.UNSIGNED_BYTE;\n\n  if (!noDataConversion) {\n    switch (readType) {\n      case gl.UNSIGNED_BYTE:\n        if (!buffer) {\n          buffer = new Uint8Array(4 * width * height);\n        }\n\n        readType = gl.UNSIGNED_BYTE;\n        break;\n\n      default:\n        if (!buffer) {\n          buffer = new Float32Array(4 * width * height);\n        }\n\n        readType = gl.FLOAT;\n        break;\n    }\n  } else if (!buffer) {\n    buffer = allocateAndCopyTypedBuffer(texture.type, 4 * width * height);\n  }\n\n  if (flushRenderer) {\n    this.flushFramebuffer();\n  }\n\n  gl.readPixels(x, y, width, height, gl.RGBA, readType, buffer);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this._currentFramebuffer);\n  return buffer;\n};\n\n_thinEngine.ThinEngine.prototype._readTexturePixels = function (texture, width, height, faceIndex = -1, level = 0, buffer = null, flushRenderer = true, noDataConversion = false, x = 0, y = 0) {\n  return Promise.resolve(this._readTexturePixelsSync(texture, width, height, faceIndex, level, buffer, flushRenderer, noDataConversion, x, y));\n};\n};"],
"names":["shadow$provide","global","require","module","exports","allocateAndCopyTypedBuffer","type","sizeOrDstBuffer","sizeInBytes","copyBuffer","buffer","Int8Array","set","Uint8Array","ArrayBuffer","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Object","defineProperty","value","_thinEngine","ThinEngine","prototype","_readTexturePixelsSync","_thinEngine.ThinEngine.prototype._readTexturePixelsSync","texture","width","height","faceIndex","level","flushRenderer","noDataConversion","x","y","_a","_b","gl","_gl","Error","_dummyFramebuffer","dummy","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_CUBE_MAP_POSITIVE_X","_hardwareTexture","underlyingResource","TEXTURE_2D","readType","undefined","_getWebGLTextureType","UNSIGNED_BYTE","FLOAT","flushFramebuffer","readPixels","RGBA","_currentFramebuffer","_readTexturePixels","_thinEngine.ThinEngine.prototype._readTexturePixels","Promise","resolve"]
}
