shadow$provide.module$node_modules$$babylonjs$core$Materials$imageProcessingConfiguration=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.ImageProcessingConfiguration=exports.ImageProcessingConfigurationDefines=void 0;global=require("module$node_modules$$babylonjs$core$tslib_es6");var _decorators=require("module$node_modules$$babylonjs$core$Misc$decorators"),_observable=require("module$node_modules$$babylonjs$core$Misc$observable"),_tools=require("module$node_modules$$babylonjs$core$Misc$tools"),
_mathColor=require("module$node_modules$$babylonjs$core$Maths$math_color");module=require("module$node_modules$$babylonjs$core$Materials$materialDefines");var _colorCurves=require("module$node_modules$$babylonjs$core$Materials$colorCurves");class ImageProcessingConfigurationDefines extends module.MaterialDefines{constructor(){super();this.SKIPFINALCOLORCLAMP=this.EXPOSURE=this.IMAGEPROCESSINGPOSTPROCESS=this.DITHER=this.SAMPLER3DBGRMAP=this.SAMPLER3DGREENDEPTH=this.COLORGRADING3D=this.COLORGRADING=
this.COLORCURVES=this.CONTRAST=this.TONEMAPPING_ACES=this.TONEMAPPING=this.VIGNETTEBLENDMODEOPAQUE=this.VIGNETTEBLENDMODEMULTIPLY=this.VIGNETTE=this.IMAGEPROCESSING=!1;this.rebuild()}}exports.ImageProcessingConfigurationDefines=ImageProcessingConfigurationDefines;class ImageProcessingConfiguration{constructor(){this.colorCurves=new _colorCurves.ColorCurves;this._colorGradingEnabled=this._colorCurvesEnabled=!1;this._colorGradingBGR=this._colorGradingWithGreenDepth=!0;this._exposure=1;this._toneMappingEnabled=
!1;this._toneMappingType=ImageProcessingConfiguration.TONEMAPPING_STANDARD;this._contrast=1;this.vignetteCenterY=this.vignetteCenterX=this.vignetteStretch=0;this.vignetteWeight=1.5;this.vignetteColor=new _mathColor.Color4(0,0,0,0);this.vignetteCameraFov=.5;this._vignetteBlendMode=ImageProcessingConfiguration.VIGNETTEMODE_MULTIPLY;this._ditheringEnabled=this._vignetteEnabled=!1;this._ditheringIntensity=1/255;this._applyByPostProcess=this._skipFinalColorClamp=!1;this._isEnabled=!0;this.onUpdateParameters=
new _observable.Observable}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(value){this._colorCurvesEnabled!==value&&(this._colorCurvesEnabled=value,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(value){this._colorGradingTexture!==value&&(this._colorGradingTexture=value,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(value){this._colorGradingEnabled!==
value&&(this._colorGradingEnabled=value,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(value){this._colorGradingWithGreenDepth!==value&&(this._colorGradingWithGreenDepth=value,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(value){this._colorGradingBGR!==value&&(this._colorGradingBGR=value,this._updateParameters())}get exposure(){return this._exposure}set exposure(value){this._exposure!==
value&&(this._exposure=value,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(value){this._toneMappingEnabled!==value&&(this._toneMappingEnabled=value,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(value){this._toneMappingType!==value&&(this._toneMappingType=value,this._updateParameters())}get contrast(){return this._contrast}set contrast(value){this._contrast!==value&&(this._contrast=value,
this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(value){this.vignetteCenterY=value}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(value){this.vignetteCenterX=value}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(value){this._vignetteBlendMode!==value&&(this._vignetteBlendMode=value,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(value){this._vignetteEnabled!==
value&&(this._vignetteEnabled=value,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(value){this._ditheringEnabled!==value&&(this._ditheringEnabled=value,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(value){this._ditheringIntensity!==value&&(this._ditheringIntensity=value,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(value){this._skipFinalColorClamp!==
value&&(this._skipFinalColorClamp=value,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(value){this._applyByPostProcess!==value&&(this._applyByPostProcess=value,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(value){this._isEnabled!==value&&(this._isEnabled=value,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}static PrepareUniforms(uniforms,
defines){defines.EXPOSURE&&uniforms.push("exposureLinear");defines.CONTRAST&&uniforms.push("contrast");defines.COLORGRADING&&uniforms.push("colorTransformSettings");(defines.VIGNETTE||defines.DITHER)&&uniforms.push("vInverseScreenSize");defines.VIGNETTE&&(uniforms.push("vignetteSettings1"),uniforms.push("vignetteSettings2"));defines.COLORCURVES&&_colorCurves.ColorCurves.PrepareUniforms(uniforms);defines.DITHER&&uniforms.push("ditherIntensity")}static PrepareSamplers(samplersList,defines){defines.COLORGRADING&&
samplersList.push("txColorTransform")}prepareDefines(defines,forPostProcess=!1){if(forPostProcess===this.applyByPostProcess&&this._isEnabled){defines.VIGNETTE=this.vignetteEnabled;defines.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY;defines.VIGNETTEBLENDMODEOPAQUE=!defines.VIGNETTEBLENDMODEMULTIPLY;defines.TONEMAPPING=this.toneMappingEnabled;switch(this._toneMappingType){case ImageProcessingConfiguration.TONEMAPPING_ACES:defines.TONEMAPPING_ACES=
!0;break;default:defines.TONEMAPPING_ACES=!1}defines.CONTRAST=1!==this.contrast;defines.EXPOSURE=1!==this.exposure;defines.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves;defines.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture;defines.COLORGRADING3D=defines.COLORGRADING?this.colorGradingTexture.is3D:!1;defines.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth;defines.SAMPLER3DBGRMAP=this.colorGradingBGR;defines.DITHER=this._ditheringEnabled;defines.IMAGEPROCESSINGPOSTPROCESS=
this.applyByPostProcess;defines.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp;defines.IMAGEPROCESSING=defines.VIGNETTE||defines.TONEMAPPING||defines.CONTRAST||defines.EXPOSURE||defines.COLORCURVES||defines.COLORGRADING||defines.DITHER}else defines.VIGNETTE=!1,defines.TONEMAPPING=!1,defines.TONEMAPPING_ACES=!1,defines.CONTRAST=!1,defines.EXPOSURE=!1,defines.COLORCURVES=!1,defines.COLORGRADING=!1,defines.COLORGRADING3D=!1,defines.DITHER=!1,defines.IMAGEPROCESSING=!1,defines.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,
defines.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(effect,overrideAspectRatio){this._colorCurvesEnabled&&this.colorCurves&&_colorCurves.ColorCurves.Bind(this.colorCurves,effect);if(this._vignetteEnabled||this._ditheringEnabled){var inverseWidth=1/effect.getEngine().getRenderWidth();const inverseHeight=1/effect.getEngine().getRenderHeight();effect.setFloat2("vInverseScreenSize",
inverseWidth,inverseHeight);this._ditheringEnabled&&effect.setFloat("ditherIntensity",.5*this._ditheringIntensity);if(this._vignetteEnabled){var vignetteScaleY=Math.tan(.5*this.vignetteCameraFov);overrideAspectRatio=vignetteScaleY*(null!=overrideAspectRatio?overrideAspectRatio:inverseHeight/inverseWidth);inverseWidth=Math.sqrt(overrideAspectRatio*vignetteScaleY);overrideAspectRatio=_tools.Tools.Mix(overrideAspectRatio,inverseWidth,this.vignetteStretch);vignetteScaleY=_tools.Tools.Mix(vignetteScaleY,
inverseWidth,this.vignetteStretch);effect.setFloat4("vignetteSettings1",overrideAspectRatio,vignetteScaleY,-overrideAspectRatio*this.vignetteCenterX,-vignetteScaleY*this.vignetteCenterY);effect.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,-2*this.vignetteWeight)}}effect.setFloat("exposureLinear",this.exposure);effect.setFloat("contrast",this.contrast);this.colorGradingTexture&&(effect.setTexture("txColorTransform",this.colorGradingTexture),vignetteScaleY=
this.colorGradingTexture.getSize().height,effect.setFloat4("colorTransformSettings",(vignetteScaleY-1)/vignetteScaleY,.5/vignetteScaleY,vignetteScaleY,this.colorGradingTexture.level))}clone(){return _decorators.SerializationHelper.Clone(()=>new ImageProcessingConfiguration,this)}serialize(){return _decorators.SerializationHelper.Serialize(this)}static Parse(source){const parsed=_decorators.SerializationHelper.Parse(()=>new ImageProcessingConfiguration,source,null,null);void 0!==source.vignetteCentreX&&
(parsed.vignetteCenterX=source.vignetteCentreX);void 0!==source.vignetteCentreY&&(parsed.vignetteCenterY=source.vignetteCentreY);return parsed}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}exports.ImageProcessingConfiguration=ImageProcessingConfiguration;ImageProcessingConfiguration.TONEMAPPING_STANDARD=0;ImageProcessingConfiguration.TONEMAPPING_ACES=1;ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY=0;ImageProcessingConfiguration._VIGNETTEMODE_OPAQUE=
1;(0,global.__decorate)([(0,_decorators.serializeAsColorCurves)()],ImageProcessingConfiguration.prototype,"colorCurves",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_colorCurvesEnabled",void 0);(0,global.__decorate)([(0,_decorators.serializeAsTexture)("colorGradingTexture")],ImageProcessingConfiguration.prototype,"_colorGradingTexture",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_colorGradingEnabled",
void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_colorGradingWithGreenDepth",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_colorGradingBGR",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_exposure",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_toneMappingEnabled",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],
ImageProcessingConfiguration.prototype,"_toneMappingType",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_contrast",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"vignetteStretch",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"vignetteCenterX",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,
"vignetteCenterY",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"vignetteWeight",void 0);(0,global.__decorate)([(0,_decorators.serializeAsColor4)()],ImageProcessingConfiguration.prototype,"vignetteColor",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"vignetteCameraFov",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_vignetteBlendMode",void 0);
(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_vignetteEnabled",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_ditheringEnabled",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_ditheringIntensity",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_skipFinalColorClamp",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],
ImageProcessingConfiguration.prototype,"_applyByPostProcess",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],ImageProcessingConfiguration.prototype,"_isEnabled",void 0);_decorators.SerializationHelper._ImageProcessingConfigurationParser=ImageProcessingConfiguration.Parse}
//# sourceMappingURL=module$node_modules$$babylonjs$core$Materials$imageProcessingConfiguration.js.map
