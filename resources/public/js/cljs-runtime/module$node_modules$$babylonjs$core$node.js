shadow$provide.module$node_modules$$babylonjs$core$node=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.Node=void 0;global=require("module$node_modules$$babylonjs$core$tslib_es6");var _mathVector=require("module$node_modules$$babylonjs$core$Maths$math_vector"),_decorators=require("module$node_modules$$babylonjs$core$Misc$decorators"),_observable=require("module$node_modules$$babylonjs$core$Misc$observable"),_engineStore=require("module$node_modules$$babylonjs$core$Engines$engineStore"),
_devTools=require("module$node_modules$$babylonjs$core$Misc$devTools");class _InternalNodeDataInfo{constructor(){this._isDisposed=this._doNotSerialize=!1;this._sceneRootNodesIndex=-1;this._isReady=this._isParentEnabled=this._isEnabled=!0;this._onEnabledStateChangedObservable=new _observable.Observable;this._onClonedObservable=new _observable.Observable}}class Node{static AddNodeConstructor(type,constructorFunc){this._NodeConstructors[type]=constructorFunc}static Construct(type,name,scene,options){return(type=
this._NodeConstructors[type])?type(name,scene,options):null}set accessibilityTag(value){this._accessibilityTag=value;this.onAccessibilityTagChangedObservable.notifyObservers(value)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return this._nodeDataStorage._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1}set doNotSerialize(value){this._nodeDataStorage._doNotSerialize=value}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(parent){if(this._parentNode!==
parent){var previousParentNode=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const index=this._parentNode._children.indexOf(this);-1!==index&&this._parentNode._children.splice(index,1);parent||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}if(this._parentNode=parent){if(void 0===this._parentNode._children||null===this._parentNode._children)this._parentNode._children=[];this._parentNode._children.push(this);previousParentNode||
this._removeFromSceneRootNodes()}this._syncParentEnabledState()}}get parent(){return this._parentNode}_serializeAsParent(serializationObject){serializationObject.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const rootNodes=this._scene.rootNodes;rootNodes[this._nodeDataStorage._sceneRootNodesIndex]=
rootNodes[rootNodes.length-1];rootNodes[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex;this._scene.rootNodes.pop();this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(value){this._animationPropertiesOverride=value}getClassName(){return"Node"}set onDispose(callback){this._onDisposeObserver&&
this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(callback)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(name,scene=null){this._isDirty=!1;this._nodeDataStorage=new _InternalNodeDataInfo;this.state="";this._accessibilityTag=this.reservedDataStore=this.metadata=null;this.onAccessibilityTagChangedObservable=
new _observable.Observable;this._parentContainer=null;this.animations=[];this._ranges={};this.onReady=null;this._childUpdateId=this._parentUpdateId=this._currentRenderId=-1;this._waitingParsedUniqueId=this._waitingParentInstanceIndex=this._waitingParentId=null;this._cache={};this._children=this._parentNode=null;this._worldMatrix=_mathVector.Matrix.Identity();this._worldMatrixDeterminant=0;this._worldMatrixDeterminantIsDirty=!0;this._animationPropertiesOverride=null;this._isNode=!0;this.onDisposeObservable=
new _observable.Observable;this._onDisposeObserver=null;this._behaviors=[];this.id=this.name=name;this._scene=scene||_engineStore.EngineStore.LastCreatedScene;this.uniqueId=this._scene.getUniqueId();this._initCache()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(behavior,attachImmediately=!1){if(-1!==this._behaviors.indexOf(behavior))return this;behavior.init();this._scene.isLoading&&!attachImmediately?this._scene.onDataLoadedObservable.addOnce(()=>{behavior.attach(this)}):
behavior.attach(this);this._behaviors.push(behavior);return this}removeBehavior(behavior){behavior=this._behaviors.indexOf(behavior);if(-1===behavior)return this;this._behaviors[behavior].detach();this._behaviors.splice(behavior,1);return this}get behaviors(){return this._behaviors}getBehaviorByName(name){for(const behavior of this._behaviors)if(behavior.name===name)return behavior;return null}getWorldMatrix(){this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix();return this._worldMatrix}_getWorldMatrixDeterminant(){this._worldMatrixDeterminantIsDirty&&
(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant());return this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={};this._cache.parent=void 0}updateCache(force){if(force||!this.isSynchronized())this._cache.parent=this.parent,this._updateCache()}_getActionManagerForTrigger(trigger,_initialCall){return this.parent?this.parent._getActionManagerForTrigger(trigger,!1):null}_updateCache(_ignoreParentClass){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&
(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return this._parentNode?this._parentNode._isDirty||this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0}isSynchronized(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()}isReady(_completeCheck){return this._nodeDataStorage._isReady}markAsDirty(_property){this._currentRenderId=
Number.MAX_VALUE;this._isDirty=!0;return this}isEnabled(checkAncestors=!0){return!1===checkAncestors?this._nodeDataStorage._isEnabled:this._nodeDataStorage._isEnabled?this._nodeDataStorage._isParentEnabled:!1}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0;this._children&&this._children.forEach(c=>{c._syncParentEnabledState()})}setEnabled(value){this._nodeDataStorage._isEnabled!==value&&(this._nodeDataStorage._isEnabled=value,this._syncParentEnabledState(),
this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(value))}isDescendantOf(ancestor){return this.parent?this.parent===ancestor?!0:this.parent.isDescendantOf(ancestor):!1}_getDescendants(results,directDescendantsOnly=!1,predicate){if(this._children)for(let index=0;index<this._children.length;index++){const item=this._children[index];predicate&&!predicate(item)||results.push(item);directDescendantsOnly||item._getDescendants(results,!1,predicate)}}getDescendants(directDescendantsOnly,
predicate){const results=[];this._getDescendants(results,directDescendantsOnly,predicate);return results}getChildMeshes(directDescendantsOnly,predicate){const results=[];this._getDescendants(results,directDescendantsOnly,node=>(!predicate||predicate(node))&&void 0!==node.cullingStrategy);return results}getChildren(predicate,directDescendantsOnly=!0){return this.getDescendants(directDescendantsOnly,predicate)}_setReady(state){if(state!==this._nodeDataStorage._isReady)if(state){if(this.onReady)this.onReady(this);
this._nodeDataStorage._isReady=!0}else this._nodeDataStorage._isReady=!1}getAnimationByName(name){for(let i=0;i<this.animations.length;i++){const animation=this.animations[i];if(animation.name===name)return animation}return null}createAnimationRange(name,from,to){if(!this._ranges[name]){this._ranges[name]=Node._AnimationRangeFactory(name,from,to);for(let i=0,nAnimations=this.animations.length;i<nAnimations;i++)this.animations[i]&&this.animations[i].createRange(name,from,to)}}deleteAnimationRange(name,
deleteFrames=!0){for(let i=0,nAnimations=this.animations.length;i<nAnimations;i++)this.animations[i]&&this.animations[i].deleteRange(name,deleteFrames);this._ranges[name]=null}getAnimationRange(name){return this._ranges[name]||null}clone(name,newParent,doNotCloneChildren){const result=_decorators.SerializationHelper.Clone(()=>new Node(name,this.getScene()),this);newParent&&(result.parent=newParent);if(!doNotCloneChildren)for(newParent=this.getDescendants(!0),doNotCloneChildren=0;doNotCloneChildren<
newParent.length;doNotCloneChildren++){const child=newParent[doNotCloneChildren];child.clone(name+"."+child.name,result)}return result}getAnimationRanges(){const animationRanges=[];let name;for(name in this._ranges)animationRanges.push(this._ranges[name]);return animationRanges}beginAnimation(name,loop,speedRatio,onAnimationEnd){return(name=this.getAnimationRange(name))?this._scene.beginAnimation(this,name.from,name.to,loop,speedRatio,onAnimationEnd):null}serializeAnimationRanges(){const serializationRanges=
[];for(const name in this._ranges){const localRange=this._ranges[name];if(!localRange)continue;const range={};range.name=name;range.from=localRange.from;range.to=localRange.to;serializationRanges.push(range)}return serializationRanges}computeWorldMatrix(_force){this._worldMatrix||(this._worldMatrix=_mathVector.Matrix.Identity());return this._worldMatrix}dispose(doNotRecurse,disposeMaterialAndTextures=!1){this._nodeDataStorage._isDisposed=!0;if(!doNotRecurse){const nodes=this.getDescendants(!0);for(const node of nodes)node.dispose(doNotRecurse,
disposeMaterialAndTextures)}this.parent?this.parent=null:this._removeFromSceneRootNodes();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onEnabledStateChangedObservable.clear();this.onClonedObservable.clear();for(const behavior of this._behaviors)behavior.detach();this._behaviors.length=0;this.metadata=null}static ParseAnimationRanges(node,parsedNode,_scene){if(parsedNode.ranges)for(_scene=0;_scene<parsedNode.ranges.length;_scene++){const data=parsedNode.ranges[_scene];
node.createAnimationRange(data.name,data.from,data.to)}}getHierarchyBoundingVectors(includeDescendants=!0,predicate=null){this.getScene().incrementRenderId();this.computeWorldMatrix(!0);let min;if(this.getBoundingInfo&&this.subMeshes){var max=this.getBoundingInfo();min=max.boundingBox.minimumWorld.clone();max=max.boundingBox.maximumWorld.clone()}else min=new _mathVector.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max=new _mathVector.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
if(includeDescendants){includeDescendants=this.getDescendants(!1);for(const descendant of includeDescendants){includeDescendants=descendant;includeDescendants.computeWorldMatrix(!0);if(predicate&&!predicate(includeDescendants))continue;if(!includeDescendants.getBoundingInfo||0===includeDescendants.getTotalVertices())continue;includeDescendants=includeDescendants.getBoundingInfo().boundingBox;const maxBox=includeDescendants.maximumWorld;_mathVector.Vector3.CheckExtends(includeDescendants.minimumWorld,
min,max);_mathVector.Vector3.CheckExtends(maxBox,min,max)}}return{min,max}}}exports.Node=Node;Node._AnimationRangeFactory=(_name,_from,_to)=>{throw(0,_devTools._WarnImport)("AnimationRange");};Node._NodeConstructors={};(0,global.__decorate)([(0,_decorators.serialize)()],Node.prototype,"name",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],Node.prototype,"id",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],Node.prototype,"uniqueId",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],
Node.prototype,"state",void 0);(0,global.__decorate)([(0,_decorators.serialize)()],Node.prototype,"metadata",void 0)}
//# sourceMappingURL=module$node_modules$$babylonjs$core$node.js.map
