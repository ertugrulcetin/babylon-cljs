{"version":3,"sources":["main/core.cljs"],"mappings":"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","names":["js/main","js/main.core","js/main.core.db","main.core/db","main.core/create-engine","canvas","e","js/module$node_modules$babylonjs$babylon.Engine","obj107263","obj107264","obj107265","main.core/create-scene","engine","s","js/module$node_modules$babylonjs$babylon.Scene","obj107268","obj107269","var_args","G__107273","main.core/v3","js/Error","main.core.v3","n","js/module$node_modules$babylonjs$babylon.Vector3","x","y","z","main.core/color","r","g","b","js/module$node_modules$babylonjs$babylon.Color3","args__5775__auto__","len__5769__auto__","i__5770__auto__","argseq__5776__auto__","cljs.core/IndexedSeq","main.core/box","p__107276","map__107277","cljs.core/--destructure-map","cljs.core.get","seq107274","G__107275","cljs.core/first","cljs.core/next","self__5754__auto__","name","size","obj__12045__auto__","f__12046__auto__","js/module$node_modules$babylonjs$babylon.MeshBuilder","main.core/capsule","p__107280","map__107281","seq107278","G__107279","height","radius","main.core/create-action-manager","obj","am","js/module$node_modules$babylonjs$babylon.ActionManager","obj107282","obj107283","main.core/register-action","action-manager","type","callback","js/module$node_modules$babylonjs$babylon.ExecuteCodeAction","obj107286","js/undefined","cljs.core/name","main.core/create-ground","p__107289","map__107290","seq107287","G__107288","width","main.core/create-ground-from-hm","p__107293","map__107294","seq107291","G__107292","texture","subdivisions","max-height","min-height","on-ready","main.core/create-arc-camera","camera","js/module$node_modules$babylonjs$babylon.ArcRotateCamera","obj107295","obj107296","obj107297","obj107298","obj107299","obj107300","obj107301","obj107304","obj107305","main.core/physics-agg","p__107310","map__107311","seq107308","G__107309","mesh","mass","friction","restitution","motion-type","mass-props","linear-damping","angular-damping","gravity-factor","agg","js/module$node_modules$babylonjs$babylon.PhysicsAggregate","obj107312","js/module$node_modules$babylonjs$babylon.PhysicsShapeType","parent__12052__auto__","f__12053__auto__","cljs.core/clj->js","obj107313","js/module$node_modules$babylonjs$babylon.PhysicsMotionType","main.core/create-player","player","main.core.capsule","obj107314","obj107315","obj107318","obj107319","obj107322","obj107326","child107323","new-child__11977__auto__","obj107329","main.core.physics_agg","main.core/set-pointer-down","scene","obj107330","obj107331","request-pointer-lock","or__5045__auto__","obj107334","obj107335","obj107336","obj107337","main.core/create-sky-box","skybox","main.core.box","mat","js/module$node_modules$babylonjs$babylon.StandardMaterial","obj107338","obj107339","obj107340","obj107341","obj107343","obj107344","obj107347","obj107350","obj107353","child107342","obj107356","obj107360","obj107363","obj107366","js/module$node_modules$babylonjs$babylon.CubeTexture","obj107357","js/module$node_modules$babylonjs$babylon.Texture","obj107367","obj107368","main.core/enable-physic-engine","hk","js/module$node_modules$babylonjs$babylon.HavokPlugin","gravity","obj107371","obj107372","main.core/create-terrain","main.core.create_ground_from_hm","ground","obj107375","obj107377","obj107379","obj107380","obj107383","obj107386","obj107389","child107378","obj107392","obj107395","child107376","obj107398","js/module$node_modules$babylonjs_materials$babylonjs_materials.GridMaterial","main.core/key-pressed?","key","out__11935__auto__","out__11934__auto__","obj107399","obj107400","applied-science.js-interop.impl/wrap-key","main.core/apply-force","force","location","main.core/apply-impulse","impulse","main.core/update-from-keyboard","obj107401","forward","obj107402","obj107403","obj107404","len","obj107405","obj107406","obj107407","obj107408","ref","_","speed","dir-vec","obj107409","obj107410","main.core/register-scene-event","f","evt","obj107411","obj107415","child107412","obj107420","obj107422","obj107421","cljs.core._EQ_","obj107424","obj107423","main.core/start-scene","js/document.getElementById","obj107425","obj107426","js/module$vendor$havok","obj107429","obj107430","error","cljs.core.println","js/module$node_modules$babylonjs$babylon.HemisphericLight","js/window.addEventListener","main.core/start","js/console.log","main.core/stop","js/console.clear","main.core/init"],"sourcesContent":["(ns main.core\n  (:require\n    [\"babylonjs\" :refer [Scene\n                         Engine\n                         Color3\n                         CubeTexture\n                         ArcRotateCamera\n                         PhysicsImpostor\n                         HemisphericLight\n                         HavokPlugin\n                         Mesh\n                         MeshBuilder\n                         StandardMaterial\n                         Texture\n                         PhysicsAggregate\n                         PhysicsShapeType\n                         PhysicsBody\n                         PhysicsMotionType\n                         ExecuteCodeAction\n                         ActionManager\n                         Vector3]]\n    [\"babylonjs-materials\" :refer [GridMaterial]]\n    [\"/vendor/havok\" :as HavokPhysics]\n    [applied-science.js-interop :as j])\n  (:require-macros [main.macros :as m]))\n\n(defonce db #js {})\n\n(defn create-engine [canvas]\n  (let [e (Engine. canvas true #js {:preserveDrawingBuffer true\n                                    :stencil true})]\n    (j/assoc! db :engine e :canvas canvas)\n    e))\n\n(defn create-scene [engine]\n  (let [s (Scene. engine)]\n    (j/assoc! db :scene s)\n    s))\n\n(defn v3\n  ([]\n   (v3 0))\n  ([n]\n   (Vector3. n n n))\n  ([x y z]\n   (Vector3. x y z)))\n\n(defn color [r g b]\n  (Color3. r g b))\n\n(defn box [name & {:keys [size]}]\n  (j/call MeshBuilder :CreateBox name #js {:size size}))\n\n(defn capsule [name & {:keys [height radius]}]\n  (j/call MeshBuilder :CreateCapsule name #js {:height height\n                                               :radius radius}))\n\n(defn create-action-manager [obj]\n  (let [am (ActionManager.)]\n    (j/assoc! obj :actionManager am)\n    am))\n\n(defn register-action [action-manager type callback]\n  (j/call action-manager :registerAction (ExecuteCodeAction. (j/get ActionManager (name type)) callback)))\n\n(defn create-ground [name & {:keys [width height]}]\n  (j/call MeshBuilder :CreateGround name #js {:width width\n                                              :height height}))\n\n(defn create-ground-from-hm [name & {:keys [texture subdivisions width height max-height min-height on-ready]}]\n  (j/call MeshBuilder :CreateGroundFromHeightMap name texture #js {:subdivisions subdivisions\n                                                                   :width width\n                                                                   :height height\n                                                                   :maxHeight max-height\n                                                                   :minHeight min-height\n                                                                   :onReady on-ready}))\n\n(defn create-arc-camera []\n  (let [camera (ArcRotateCamera. \"camera\" 0 0 10 (v3))]\n    (j/call camera :setPosition (v3 50 50 50))\n    (j/call camera :attachControl (j/get db :canvas) true)\n    (j/assoc! camera\n              :checkCollisions true\n              :applyGravity true\n              :collisionRadius (v3 0.5)\n              :lowerRadiusLimit 2\n              :upperRadiusLimit 20)\n    (j/assoc! db :camera camera)\n    camera))\n\n(defn physics-agg [mesh & {:keys [type\n                                  mass\n                                  friction\n                                  restitution\n                                  motion-type\n                                  mass-props\n                                  linear-damping\n                                  angular-damping\n                                  gravity-factor]}]\n  (let [agg (PhysicsAggregate. mesh (j/get PhysicsShapeType (name type)) #js {:mass mass\n                                                                              :friction friction\n                                                                              :restitution restitution})]\n    (when gravity-factor\n      (j/call-in agg [:body :setGravityFactor] gravity-factor))\n    (when linear-damping\n      (j/call-in agg [:body :setLinearDamping] linear-damping))\n    (when angular-damping\n      (j/call-in agg [:body :setAngularDamping] angular-damping))\n    (when mass-props\n      (j/call-in agg [:body :setMassProperties] (clj->js mass-props)))\n    (when motion-type\n      (j/call-in agg [:body :setMotionType] (j/get PhysicsMotionType (name motion-type))))))\n\n(defn create-player []\n  (let [player (capsule \"player\" :height 1)\n        mass 50]\n    (j/assoc! player :checkCollisions true)\n    (j/assoc! db :player player)\n    (j/assoc-in! player [:position :y] 8)\n    (physics-agg player\n                 :type :PhysicsShapeType/CAPSULE\n                 :mass mass\n                 :restitution 0.0\n                 :friction 1.0\n                 :linear-damping 1.5\n                 :angular-damping 0\n                 :gravity-factor 1.5\n                 :motion-type :PhysicsMotionType/DYNAMIC\n                 :mass-props {:inertia (v3)\n                              :mass mass})\n    player))\n\n(defn set-pointer-down [scene canvas]\n  (j/assoc! scene :onPointerDown\n            (fn []\n              (let [request-pointer-lock (or (j/get canvas :requestPointerLock)\n                                             (j/get canvas :msRequestPointerLock)\n                                             (j/get canvas :mozRequestPointerLock)\n                                             (j/get canvas :webkitRequestPointerLock))]\n                (when request-pointer-lock\n                  (j/call canvas :requestPointerLock))))))\n\n(defn create-sky-box []\n  (let [skybox (box \"skyBox\" :size 5000.0)\n        mat (StandardMaterial. \"skyBox\")]\n    (m/assoc! mat :backFaceCulling false\n              :reflectionTexture (CubeTexture. \"//www.babylonjs.com/assets/skybox/TropicalSunnyDay\")\n              :reflectionTexture.coordinatesMode (j/get Texture :SKYBOX_MODE)\n              :diffuseColor (color 0 0 0)\n              :specularColor (color 0 0 0)\n              :disableLighting true)\n    (j/assoc! skybox :material mat)\n    skybox))\n\n(defn enable-physic-engine [hk scene]\n  (let [hk (HavokPlugin. true hk)\n        gravity (v3 0 -9.8 0)]\n    (j/call scene :enablePhysics gravity hk)\n    (j/assoc! scene :collisionsEnabled true)))\n\n(defn create-terrain []\n  #_(let [ground (create-ground \"ground\"\n                                :width 100\n                                :height 100)]\n      (physics-agg ground\n                   :type :PhysicsShapeType/BOX\n                   :friction 0.02\n                   :mass 0)\n      (m/assoc! ground :material (GridMaterial. \"groundMaterial\")\n                :checkCollisions true\n                :position.y -2\n                :position.x -28))\n  (create-ground-from-hm \"ground\"\n                         :texture \"img/heightMap.png\"\n                         :subdivisions 50\n                         :width 100\n                         :height 100\n                         :max-height 10\n                         :min-height 0\n                         :on-ready (fn [ground]\n                                     (physics-agg ground\n                                                  :type :PhysicsShapeType/MESH\n                                                  :friction 0.5\n                                                  :restitution 0.0\n                                                  :mass 0\n                                                  :motion-type :PhysicsMotionType/STATIC)\n                                     (m/assoc! ground :material (GridMaterial. \"groundMaterial\")\n                                               :checkCollisions true\n                                               :position.y -2\n                                               :position.x -28))))\n\n(defn key-pressed? [key]\n  (j/get-in db [:input-map key] false))\n\n(defn apply-force [mesh force location]\n  (j/call-in mesh [:physicsBody :applyForce] force location))\n\n(defn apply-impulse [mesh impulse location]\n  (j/call-in mesh [:physicsBody :applyImpulse] impulse location))\n\n(defn update-from-keyboard []\n  (let [camera (j/get db :camera)\n        forward (j/get (j/call camera :getForwardRay) :direction)\n        forward (v3 (j/get forward :x) 0 (j/get forward :z))\n        len (j/call forward :length)\n        forward (v3 (/ (j/get forward :x) len) 0 (/ (j/get forward :z) len))\n        x (j/get forward :x)\n        z (j/get forward :z)\n        ref (v3)\n        _ (j/call-in db [:player :physicsBody :getLinearVelocityToRef] ref)\n        speed 2\n        dir-vec (v3 (* x speed) (j/get ref :y) (* z speed))]\n    (when (key-pressed? :Space)\n      (apply-impulse (j/get db :player) (v3 0 100 0) (j/call-in db [:player :getAbsolutePosition])))\n    (when (key-pressed? :KeyW)\n      (j/call-in db [:player :physicsBody :setLinearVelocity] dir-vec)\n      #_(j/call-in db [:player :physicsBody :applyForce]\n                   (v3 (* x speed) 0 (* z speed))\n                   (j/call-in db [:player :getAbsolutePosition])\n                   #_(j/call-in db [:player :physicsBody :getObjectCenterWorld])))))\n\n(defn register-scene-event [scene]\n  (let [action-manager (create-action-manager scene)\n        f (fn [evt]\n            (j/assoc-in! db [:input-map (m/get evt :sourceEvent :code)] (= (m/get evt :sourceEvent :type) \"keydown\")))]\n    (register-action action-manager :ActionManager/OnKeyDownTrigger f)\n    (register-action action-manager :ActionManager/OnKeyUpTrigger f)))\n\n(defn start-scene []\n  (let [canvas (js/document.getElementById \"renderCanvas\")\n        engine (create-engine canvas)\n        scene (create-scene engine)\n        camera (create-arc-camera)\n        mat (StandardMaterial. \"material\")]\n    (j/assoc! mat :emissiveColor (color 0 0.58 0.86))\n    (set-pointer-down scene canvas)\n    (create-sky-box)\n    (.then (HavokPhysics)\n           (fn [hk]\n             (enable-physic-engine hk scene)\n             (let [player (create-player)]\n               (j/assoc! player :material mat)\n               (j/call camera :setTarget player))\n             (create-terrain)\n             (register-scene-event scene)\n             (j/call-in scene [:onBeforeRenderObservable :add] #(update-from-keyboard)))\n           (fn [error]\n             (println error)))\n    (HemisphericLight. \"light1\" (v3 0 1 0))\n    (j/call engine :runRenderLoop #(j/call scene :render))\n    (js/window.addEventListener \"resize\" #(j/call engine :resize))))\n\n(defn ^:dev/after-load start []\n  (js/console.log \"start\")\n  (start-scene))\n\n;;TODO make sure clear all event listeners\n(defn ^:dev/before-load stop []\n  (js/console.clear)\n  (js/console.log \"stop\")\n  (j/call-in db [:engine :dispose]))\n\n(defn init []\n  (js/console.log \"init\")\n  (start))\n\n(comment\n  (j/call-in db [:engine :getFps])\n  (j/call-in db [:scene :debugLayer :show])\n  (j/call-in db [:player :physicsBody :applyForce] (v3 -50 0 0) (v3 0 0 0))\n  )"]}