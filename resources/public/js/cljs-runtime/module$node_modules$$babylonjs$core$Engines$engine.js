shadow$provide.module$node_modules$$babylonjs$core$Engines$engine=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.Engine=void 0;var _observable=require("module$node_modules$$babylonjs$core$Misc$observable"),_internalTexture=require("module$node_modules$$babylonjs$core$Materials$Textures$internalTexture"),_domManagement=require("module$node_modules$$babylonjs$core$Misc$domManagement"),_engineStore=require("module$node_modules$$babylonjs$core$Engines$engineStore"),
_devTools=require("module$node_modules$$babylonjs$core$Misc$devTools"),_thinEngine=require("module$node_modules$$babylonjs$core$Engines$thinEngine"),_performanceMonitor=require("module$node_modules$$babylonjs$core$Misc$performanceMonitor"),_perfCounter=require("module$node_modules$$babylonjs$core$Misc$perfCounter"),_webGLDataBuffer=require("module$node_modules$$babylonjs$core$Meshes$WebGL$webGLDataBuffer"),_logger=require("module$node_modules$$babylonjs$core$Misc$logger"),_webGLHardwareTexture=require("module$node_modules$$babylonjs$core$Engines$WebGL$webGLHardwareTexture");
require("module$node_modules$$babylonjs$core$Engines$Extensions$engine_alpha");require("module$node_modules$$babylonjs$core$Engines$Extensions$engine_readTexture");require("module$node_modules$$babylonjs$core$Engines$Extensions$engine_dynamicBuffer");class Engine extends _thinEngine.ThinEngine{static get NpmPackage(){return _thinEngine.ThinEngine.NpmPackage}static get Version(){return _thinEngine.ThinEngine.Version}static get Instances(){return _engineStore.EngineStore.Instances}static get LastCreatedEngine(){return _engineStore.EngineStore.LastCreatedEngine}static get LastCreatedScene(){return _engineStore.EngineStore.LastCreatedScene}_createImageBitmapFromSource(imageSource,
options){return new Promise((resolve,reject)=>{const image=new Image;image.onload=()=>{image.decode().then(()=>{this.createImageBitmap(image,options).then(imageBitmap=>{resolve(imageBitmap)})})};image.onerror=()=>{reject(`Error loading image ${image.src}`)};image.src=imageSource})}createImageBitmap(image,options){return createImageBitmap(image,options)}resizeImageBitmap(image,bufferWidth,bufferHeight){const context=this.createCanvas(bufferWidth,bufferHeight).getContext("2d");if(!context)throw Error("Unable to get 2d context for resizeImageBitmap");
context.drawImage(image,0,0);return context.getImageData(0,0,bufferWidth,bufferHeight).data}static MarkAllMaterialsAsDirty(flag,predicate){for(let engineIndex=0;engineIndex<Engine.Instances.length;engineIndex++){const engine=Engine.Instances[engineIndex];for(let sceneIndex=0;sceneIndex<engine.scenes.length;sceneIndex++)engine.scenes[sceneIndex].markAllMaterialsAsDirty(flag,predicate)}}static DefaultLoadingScreenFactory(canvas){throw(0,_devTools._WarnImport)("LoadingScreen");}get _supportsHardwareTextureRescaling(){return!!Engine._RescalePostProcessFactory}get performanceMonitor(){return this._performanceMonitor}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(mode){this._compatibilityMode=
!0}getInputElement(){return this._renderingCanvas}constructor(canvasOrContext,antialias,options,adaptToDeviceRatio=!1){super(canvasOrContext,antialias,options,adaptToDeviceRatio);this.disableManifestCheck=this.enableOfflineSupport=!1;this.disableContextMenu=!0;this.scenes=[];this._virtualScenes=[];this.onNewSceneAddedObservable=new _observable.Observable;this.postProcesses=[];this.isPointerLock=!1;this.onResizeObservable=new _observable.Observable;this.onCanvasBlurObservable=new _observable.Observable;
this.onCanvasFocusObservable=new _observable.Observable;this.onCanvasPointerOutObservable=new _observable.Observable;this.onBeginFrameObservable=new _observable.Observable;this.customAnimationFrameRequester=null;this.onEndFrameObservable=new _observable.Observable;this.onBeforeShaderCompilationObservable=new _observable.Observable;this.onAfterShaderCompilationObservable=new _observable.Observable;this._deterministicLockstep=!1;this._lockstepMaxSteps=4;this._timeStep=1/60;this._fps=60;this._deltaTime=
0;this._drawCalls=new _perfCounter.PerfCounter;this.canvasTabIndex=1;this.disablePerformanceMonitorInBackground=!1;this._performanceMonitor=new _performanceMonitor.PerformanceMonitor;this._compatibilityMode=!0;this.currentRenderPassId=0;this._renderPassNames=["main"];Engine.Instances.push(this);canvasOrContext&&(this._features.supportRenderPasses=!0,options=this._creationOptions,canvasOrContext.getContext&&(this._sharedInit(canvasOrContext),this._connectVREvents()),this._prepareVRComponent(),options.autoEnableWebVR&&
this.initWebVR())}_initGLContext(){super._initGLContext();this._rescalePostProcess=null}_sharedInit(canvas){super._sharedInit(canvas);this._onCanvasFocus=()=>{this.onCanvasFocusObservable.notifyObservers(this)};this._onCanvasBlur=()=>{this.onCanvasBlurObservable.notifyObservers(this)};this._onCanvasContextMenu=evt=>{this.disableContextMenu&&evt.preventDefault()};canvas.addEventListener("focus",this._onCanvasFocus);canvas.addEventListener("blur",this._onCanvasBlur);canvas.addEventListener("contextmenu",
this._onCanvasContextMenu);this._onBlur=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.disable();this._windowIsBackground=!0};this._onFocus=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.enable();this._windowIsBackground=!1};this._onCanvasPointerOut=ev=>{document.elementFromPoint(ev.clientX,ev.clientY)!==canvas&&this.onCanvasPointerOutObservable.notifyObservers(ev)};const hostWindow=this.getHostWindow();hostWindow&&"function"===typeof hostWindow.addEventListener&&
(hostWindow.addEventListener("blur",this._onBlur),hostWindow.addEventListener("focus",this._onFocus));canvas.addEventListener("pointerout",this._onCanvasPointerOut);this._creationOptions.doNotHandleTouchAction||this._disableTouchAction();!Engine.audioEngine&&this._creationOptions.audioEngine&&Engine.AudioEngineFactory&&(Engine.audioEngine=Engine.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()));(0,_domManagement.IsDocumentAvailable)()&&(this._onFullscreenChange=
()=>{(this.isFullscreen=!!document.fullscreenElement)&&this._pointerLockRequested&&canvas&&Engine._RequestPointerlock(canvas)},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=()=>{this.isPointerLock=document.pointerLockElement===canvas},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,
!1));this.enableOfflineSupport=void 0!==Engine.OfflineProviderFactory;this._deterministicLockstep=!!this._creationOptions.deterministicLockstep;this._lockstepMaxSteps=this._creationOptions.lockstepMaxSteps||0;this._timeStep=this._creationOptions.timeStep||1/60}_verifyPointerLock(){var _a;null===(_a=this._onPointerLockChange)||void 0===_a?void 0:_a.call(this)}getAspectRatio(viewportOwner,useScreen=!1){viewportOwner=viewportOwner.viewport;return this.getRenderWidth(useScreen)*viewportOwner.width/(this.getRenderHeight(useScreen)*
viewportOwner.height)}getScreenAspectRatio(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)}getRenderingCanvasClientRect(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null}getInputElementClientRect(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1E3*this._timeStep}generateMipMapsForCubemap(texture,
unbind=!0){if(texture.generateMipMaps){const gl=this._gl;this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,!0);gl.generateMipmap(gl.TEXTURE_CUBE_MAP);unbind&&this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null)}}getDepthWrite(){return this._depthCullingState.depthMask}setDepthWrite(enable){this._depthCullingState.depthMask=enable}getStencilBuffer(){return this._stencilState.stencilTest}setStencilBuffer(enable){this._stencilState.stencilTest=enable}getStencilMask(){return this._stencilState.stencilMask}setStencilMask(mask){this._stencilState.stencilMask=
mask}getStencilFunction(){return this._stencilState.stencilFunc}getStencilFunctionReference(){return this._stencilState.stencilFuncRef}getStencilFunctionMask(){return this._stencilState.stencilFuncMask}setStencilFunction(stencilFunc){this._stencilState.stencilFunc=stencilFunc}setStencilFunctionReference(reference){this._stencilState.stencilFuncRef=reference}setStencilFunctionMask(mask){this._stencilState.stencilFuncMask=mask}getStencilOperationFail(){return this._stencilState.stencilOpStencilFail}getStencilOperationDepthFail(){return this._stencilState.stencilOpDepthFail}getStencilOperationPass(){return this._stencilState.stencilOpStencilDepthPass}setStencilOperationFail(operation){this._stencilState.stencilOpStencilFail=
operation}setStencilOperationDepthFail(operation){this._stencilState.stencilOpDepthFail=operation}setStencilOperationPass(operation){this._stencilState.stencilOpStencilDepthPass=operation}setDitheringState(value){value?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(value){value?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}getDepthFunction(){return this._depthCullingState.depthFunc}setDepthFunction(depthFunc){this._depthCullingState.depthFunc=
depthFunc}setDepthFunctionToGreater(){this.setDepthFunction(516)}setDepthFunctionToGreaterOrEqual(){this.setDepthFunction(518)}setDepthFunctionToLess(){this.setDepthFunction(513)}setDepthFunctionToLessOrEqual(){this.setDepthFunction(515)}cacheStencilState(){this._cachedStencilBuffer=this.getStencilBuffer();this._cachedStencilFunction=this.getStencilFunction();this._cachedStencilMask=this.getStencilMask();this._cachedStencilOperationPass=this.getStencilOperationPass();this._cachedStencilOperationFail=
this.getStencilOperationFail();this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail();this._cachedStencilReference=this.getStencilFunctionReference()}restoreStencilState(){this.setStencilFunction(this._cachedStencilFunction);this.setStencilMask(this._cachedStencilMask);this.setStencilBuffer(this._cachedStencilBuffer);this.setStencilOperationPass(this._cachedStencilOperationPass);this.setStencilOperationFail(this._cachedStencilOperationFail);this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail);
this.setStencilFunctionReference(this._cachedStencilReference)}setDirectViewport(x,y,width,height){const currentViewport=this._cachedViewport;this._cachedViewport=null;this._viewport(x,y,width,height);return currentViewport}scissorClear(x,y,width,height,clearColor){this.enableScissor(x,y,width,height);this.clear(clearColor,!0,!0,!0);this.disableScissor()}enableScissor(x,y,width,height){const gl=this._gl;gl.enable(gl.SCISSOR_TEST);gl.scissor(x,y,width,height)}disableScissor(){const gl=this._gl;gl.disable(gl.SCISSOR_TEST)}_reportDrawCall(numDrawCalls=
1){this._drawCalls.addCount(numDrawCalls,!1)}initWebVR(){throw(0,_devTools._WarnImport)("WebVRCamera");}_prepareVRComponent(){}_connectVREvents(canvas,document){}_submitVRFrame(){}disableVR(){}isVRPresenting(){return!1}_requestVRFrame(){}_loadFileAsync(url,offlineProvider,useArrayBuffer){return new Promise((resolve,reject)=>{this._loadFile(url,data=>{resolve(data)},void 0,offlineProvider,useArrayBuffer,(request,exception)=>{reject(exception)})})}getVertexShaderSource(program){return(program=this._gl.getAttachedShaders(program))?
this._gl.getShaderSource(program[0]):null}getFragmentShaderSource(program){return(program=this._gl.getAttachedShaders(program))?this._gl.getShaderSource(program[1]):null}setDepthStencilTexture(channel,uniform,texture,name){void 0!==channel&&(uniform&&(this._boundUniforms[channel]=uniform),texture&&texture.depthStencilTexture?this._setTexture(channel,texture,!1,!0,name):this._setTexture(channel,null,void 0,void 0,name))}setTextureFromPostProcess(channel,postProcess,name){var _a;let postProcessInput=
null;postProcess&&(postProcess._forcedOutputTexture?postProcessInput=postProcess._forcedOutputTexture:postProcess._textures.data[postProcess._currentRenderTextureInd]&&(postProcessInput=postProcess._textures.data[postProcess._currentRenderTextureInd]));this._bindTexture(channel,null!==(_a=null===postProcessInput||void 0===postProcessInput?void 0:postProcessInput.texture)&&void 0!==_a?_a:null,name)}setTextureFromPostProcessOutput(channel,postProcess,name){var _a,_b;this._bindTexture(channel,null!==
(_b=null===(_a=null===postProcess||void 0===postProcess?void 0:postProcess._outputTexture)||void 0===_a?void 0:_a.texture)&&void 0!==_b?_b:null,name)}_rebuildBuffers(){for(const scene of this.scenes)scene.resetCachedMaterial(),scene._rebuildGeometries(),scene._rebuildTextures();for(const scene of this._virtualScenes)scene.resetCachedMaterial(),scene._rebuildGeometries(),scene._rebuildTextures();super._rebuildBuffers()}_renderFrame(){for(let index=0;index<this._activeRenderLoops.length;index++)(0,this._activeRenderLoops[index])()}_renderLoop(){if(!this._contextWasLost){let shouldRender=
!0;if(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)shouldRender=!1;shouldRender&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}0<this._activeRenderLoops.length?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?
this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}_renderViews(){return!1}switchFullscreen(requestPointerLock){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(requestPointerLock)}enterFullscreen(requestPointerLock){this.isFullscreen||(this._pointerLockRequested=requestPointerLock,this._renderingCanvas&&Engine._RequestFullscreen(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&Engine._ExitFullscreen()}enterPointerlock(){this._renderingCanvas&&
Engine._RequestPointerlock(this._renderingCanvas)}exitPointerlock(){Engine._ExitPointerlock()}beginFrame(){this._measureFps();this.onBeginFrameObservable.notifyObservers(this);super.beginFrame()}endFrame(){super.endFrame();this._submitVRFrame();this.onEndFrameObservable.notifyObservers(this)}resize(forceSetSize=!1){this.isVRPresenting()||super.resize(forceSetSize)}setSize(width,height,forceSetSize=!1){if(!this._renderingCanvas||!super.setSize(width,height,forceSetSize))return!1;if(this.scenes){for(width=
0;width<this.scenes.length;width++)for(height=this.scenes[width],forceSetSize=0;forceSetSize<height.cameras.length;forceSetSize++)height.cameras[forceSetSize]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}_deletePipelineContext(pipelineContext){pipelineContext&&pipelineContext.program&&pipelineContext.transformFeedback&&(this.deleteTransformFeedback(pipelineContext.transformFeedback),pipelineContext.transformFeedback=null);super._deletePipelineContext(pipelineContext)}createShaderProgram(pipelineContext,
vertexCode,fragmentCode,defines,context,transformFeedbackVaryings=null){context=context||this._gl;this.onBeforeShaderCompilationObservable.notifyObservers(this);pipelineContext=super.createShaderProgram(pipelineContext,vertexCode,fragmentCode,defines,context,transformFeedbackVaryings);this.onAfterShaderCompilationObservable.notifyObservers(this);return pipelineContext}_createShaderProgram(pipelineContext,vertexShader,fragmentShader,context,transformFeedbackVaryings=null){const shaderProgram=context.createProgram();
pipelineContext.program=shaderProgram;if(!shaderProgram)throw Error("Unable to create program");context.attachShader(shaderProgram,vertexShader);context.attachShader(shaderProgram,fragmentShader);if(1<this.webGLVersion&&transformFeedbackVaryings){const transformFeedback=this.createTransformFeedback();this.bindTransformFeedback(transformFeedback);this.setTranformFeedbackVaryings(shaderProgram,transformFeedbackVaryings);pipelineContext.transformFeedback=transformFeedback}context.linkProgram(shaderProgram);
1<this.webGLVersion&&transformFeedbackVaryings&&this.bindTransformFeedback(null);pipelineContext.context=context;pipelineContext.vertexShader=vertexShader;pipelineContext.fragmentShader=fragmentShader;pipelineContext.isParallelCompiled||this._finalizePipelineContext(pipelineContext);return shaderProgram}_releaseTexture(texture){super._releaseTexture(texture)}_releaseRenderTargetWrapper(rtWrapper){super._releaseRenderTargetWrapper(rtWrapper);this.scenes.forEach(scene=>{scene.postProcesses.forEach(postProcess=>
{postProcess._outputTexture===rtWrapper&&(postProcess._outputTexture=null)});scene.cameras.forEach(camera=>{camera._postProcesses.forEach(postProcess=>{postProcess&&postProcess._outputTexture===rtWrapper&&(postProcess._outputTexture=null)})})})}getRenderPassNames(){return this._renderPassNames}getCurrentRenderPassName(){return this._renderPassNames[this.currentRenderPassId]}createRenderPassId(name){const id=++Engine._RenderPassIdCounter;this._renderPassNames[id]=null!==name&&void 0!==name?name:"NONAME";
return id}releaseRenderPassId(id){this._renderPassNames[id]=void 0;for(let s=0;s<this.scenes.length;++s){const scene=this.scenes[s];for(let m=0;m<scene.meshes.length;++m){const mesh=scene.meshes[m];if(mesh.subMeshes)for(let b=0;b<mesh.subMeshes.length;++b)mesh.subMeshes[b]._removeDrawWrapper(id)}}}_rescaleTexture(source,destination,scene,internalFormat,onComplete){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,
this._gl.LINEAR);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const rtt=this.createRenderTargetTexture({width:destination.width,height:destination.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&Engine._RescalePostProcessFactory&&(this._rescalePostProcess=Engine._RescalePostProcessFactory(this));
this._rescalePostProcess&&(this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled(()=>{this._rescalePostProcess.onApply=function(effect){effect._bindTexture("textureSampler",source)};let hostingScene=scene;hostingScene||(hostingScene=this.scenes[this.scenes.length-1]);hostingScene.postProcessManager.directRender([this._rescalePostProcess],rtt,!0);this._bindTextureDirectly(this._gl.TEXTURE_2D,destination,!0);this._gl.copyTexImage2D(this._gl.TEXTURE_2D,
0,internalFormat,0,0,destination.width,destination.height,0);this.unBindFramebuffer(rtt);rtt.dispose();onComplete&&onComplete()}))}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}_measureFps(){this._performanceMonitor.sampleFrame();this._fps=this._performanceMonitor.averageFPS;this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}wrapWebGLTexture(texture,hasMipMaps=!1,samplingMode=3){texture=new _webGLHardwareTexture.WebGLHardwareTexture(texture,this._gl);const internalTexture=
new _internalTexture.InternalTexture(this,_internalTexture.InternalTextureSource.Unknown,!0);internalTexture._hardwareTexture=texture;internalTexture.isReady=!0;internalTexture.useMipMaps=hasMipMaps;this.updateTextureSamplingMode(samplingMode,internalTexture);return internalTexture}_uploadImageToTexture(texture,image,faceIndex=0,lod=0){const gl=this._gl,textureType=this._getWebGLTextureType(texture.type),format=this._getInternalFormat(texture.format),internalFormat=this._getRGBABufferInternalSizedFormat(texture.type,
format),bindTarget=texture.isCube?gl.TEXTURE_CUBE_MAP:gl.TEXTURE_2D;this._bindTextureDirectly(bindTarget,texture,!0);this._unpackFlipY(texture.invertY);let target=gl.TEXTURE_2D;texture.isCube&&(target=gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex);gl.texImage2D(target,lod,internalFormat,format,textureType,image);this._bindTextureDirectly(bindTarget,null,!0)}updateTextureComparisonFunction(texture,comparisonFunction){if(1===this.webGLVersion)_logger.Logger.Error("WebGL 1 does not support texture comparison.");
else{var gl=this._gl;texture.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,texture,!0),0===comparisonFunction?(gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_FUNC,515),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_MODE,gl.NONE)):(gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_FUNC,comparisonFunction),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,
texture,!0),0===comparisonFunction?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_FUNC,515),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_MODE,gl.NONE)):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_FUNC,comparisonFunction),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null));texture._comparisonFunction=comparisonFunction}}createInstancesBuffer(capacity){var buffer=this._gl.createBuffer();if(!buffer)throw Error("Unable to create instance buffer");
buffer=new _webGLDataBuffer.WebGLDataBuffer(buffer);buffer.capacity=capacity;this.bindArrayBuffer(buffer);this._gl.bufferData(this._gl.ARRAY_BUFFER,capacity,this._gl.DYNAMIC_DRAW);buffer.references=1;return buffer}deleteInstancesBuffer(buffer){this._gl.deleteBuffer(buffer)}_clientWaitAsync(sync,flags=0,intervalms=10){const gl=this._gl;return new Promise((resolve,reject)=>{const check=()=>{const res=gl.clientWaitSync(sync,flags,0);res==gl.WAIT_FAILED?reject():res==gl.TIMEOUT_EXPIRED?setTimeout(check,
intervalms):resolve()};check()})}_readPixelsAsync(x,y,w,h,format,type,outputBuffer){if(2>this._webGLVersion)throw Error("_readPixelsAsync only work on WebGL2+");const gl=this._gl,buf=gl.createBuffer();gl.bindBuffer(gl.PIXEL_PACK_BUFFER,buf);gl.bufferData(gl.PIXEL_PACK_BUFFER,outputBuffer.byteLength,gl.STREAM_READ);gl.readPixels(x,y,w,h,format,type,0);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null);const sync=gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE,0);if(!sync)return null;gl.flush();return this._clientWaitAsync(sync,
0,10).then(()=>{gl.deleteSync(sync);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,buf);gl.getBufferSubData(gl.PIXEL_PACK_BUFFER,0,outputBuffer);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null);gl.deleteBuffer(buf);return outputBuffer})}dispose(){this.hideLoadingUI();for(this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();
1===_engineStore.EngineStore.Instances.length&&Engine.audioEngine&&(Engine.audioEngine.dispose(),Engine.audioEngine=null);this.disableVR();var hostWindow=this.getHostWindow();hostWindow&&"function"===typeof hostWindow.removeEventListener&&(hostWindow.removeEventListener("blur",this._onBlur),hostWindow.removeEventListener("focus",this._onFocus));this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),
this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu));(0,_domManagement.IsDocumentAvailable)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),
document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange));super.dispose();hostWindow=_engineStore.EngineStore.Instances.indexOf(this);0<=hostWindow&&_engineStore.EngineStore.Instances.splice(hostWindow,1);Engine.Instances.length||_engineStore.EngineStore.OnEnginesDisposedObservable.notifyObservers(this);
this.onResizeObservable.clear();this.onCanvasBlurObservable.clear();this.onCanvasFocusObservable.clear();this.onCanvasPointerOutObservable.clear();this.onBeginFrameObservable.clear();this.onEndFrameObservable.clear()}_disableTouchAction(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")}displayLoadingUI(){if((0,_domManagement.IsWindowObjectExist)()){var loadingScreen=
this.loadingScreen;loadingScreen&&loadingScreen.displayLoadingUI()}}hideLoadingUI(){if((0,_domManagement.IsWindowObjectExist)()){var loadingScreen=this._loadingScreen;loadingScreen&&loadingScreen.hideLoadingUI()}}get loadingScreen(){!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=Engine.DefaultLoadingScreenFactory(this._renderingCanvas));return this._loadingScreen}set loadingScreen(loadingScreen){this._loadingScreen=loadingScreen}set loadingUIText(text){this.loadingScreen.loadingUIText=
text}set loadingUIBackgroundColor(color){this.loadingScreen.loadingUIBackgroundColor=color}createVideoElement(constraints){return document.createElement("video")}static _RequestPointerlock(element){if(element.requestPointerLock){const promise=element.requestPointerLock();promise instanceof Promise?promise.then(()=>{element.focus()}).catch(()=>{}):element.focus()}}static _ExitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}static _RequestFullscreen(element){const requestFunction=
element.requestFullscreen||element.webkitRequestFullscreen;requestFunction&&requestFunction.call(element)}static _ExitFullscreen(){const anyDoc=document;document.exitFullscreen?document.exitFullscreen():anyDoc.webkitCancelFullScreen&&anyDoc.webkitCancelFullScreen()}getFontOffset(font){const text=document.createElement("span");text.innerHTML="Hg";text.setAttribute("style",`font: ${font} !important`);font=document.createElement("div");font.style.display="inline-block";font.style.width="1px";font.style.height=
"0px";font.style.verticalAlign="bottom";const div=document.createElement("div");div.style.whiteSpace="nowrap";div.appendChild(text);div.appendChild(font);document.body.appendChild(div);let fontAscent=0,fontHeight=0;try{fontHeight=font.getBoundingClientRect().top-text.getBoundingClientRect().top,font.style.verticalAlign="baseline",fontAscent=font.getBoundingClientRect().top-text.getBoundingClientRect().top}finally{document.body.removeChild(div)}return{ascent:fontAscent,height:fontHeight,descent:fontHeight-
fontAscent}}}exports.Engine=Engine;Engine.ALPHA_DISABLE=0;Engine.ALPHA_ADD=1;Engine.ALPHA_COMBINE=2;Engine.ALPHA_SUBTRACT=3;Engine.ALPHA_MULTIPLY=4;Engine.ALPHA_MAXIMIZED=5;Engine.ALPHA_ONEONE=6;Engine.ALPHA_PREMULTIPLIED=7;Engine.ALPHA_PREMULTIPLIED_PORTERDUFF=8;Engine.ALPHA_INTERPOLATE=9;Engine.ALPHA_SCREENMODE=10;Engine.DELAYLOADSTATE_NONE=0;Engine.DELAYLOADSTATE_LOADED=1;Engine.DELAYLOADSTATE_LOADING=2;Engine.DELAYLOADSTATE_NOTLOADED=4;Engine.NEVER=512;Engine.ALWAYS=519;Engine.LESS=513;Engine.EQUAL=
514;Engine.LEQUAL=515;Engine.GREATER=516;Engine.GEQUAL=518;Engine.NOTEQUAL=517;Engine.KEEP=7680;Engine.REPLACE=7681;Engine.INCR=7682;Engine.DECR=7683;Engine.INVERT=5386;Engine.INCR_WRAP=34055;Engine.DECR_WRAP=34056;Engine.TEXTURE_CLAMP_ADDRESSMODE=0;Engine.TEXTURE_WRAP_ADDRESSMODE=1;Engine.TEXTURE_MIRROR_ADDRESSMODE=2;Engine.TEXTUREFORMAT_ALPHA=0;Engine.TEXTUREFORMAT_LUMINANCE=1;Engine.TEXTUREFORMAT_LUMINANCE_ALPHA=2;Engine.TEXTUREFORMAT_RGB=4;Engine.TEXTUREFORMAT_RGBA=5;Engine.TEXTUREFORMAT_RED=
6;Engine.TEXTUREFORMAT_R=6;Engine.TEXTUREFORMAT_RG=7;Engine.TEXTUREFORMAT_RED_INTEGER=8;Engine.TEXTUREFORMAT_R_INTEGER=8;Engine.TEXTUREFORMAT_RG_INTEGER=9;Engine.TEXTUREFORMAT_RGB_INTEGER=10;Engine.TEXTUREFORMAT_RGBA_INTEGER=11;Engine.TEXTURETYPE_UNSIGNED_BYTE=0;Engine.TEXTURETYPE_UNSIGNED_INT=0;Engine.TEXTURETYPE_FLOAT=1;Engine.TEXTURETYPE_HALF_FLOAT=2;Engine.TEXTURETYPE_BYTE=3;Engine.TEXTURETYPE_SHORT=4;Engine.TEXTURETYPE_UNSIGNED_SHORT=5;Engine.TEXTURETYPE_INT=6;Engine.TEXTURETYPE_UNSIGNED_INTEGER=
7;Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;Engine.TEXTURETYPE_UNSIGNED_INT_24_8=12;Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;Engine.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;Engine.TEXTURE_NEAREST_SAMPLINGMODE=1;Engine.TEXTURE_BILINEAR_SAMPLINGMODE=2;Engine.TEXTURE_TRILINEAR_SAMPLINGMODE=3;Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR=
8;Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;Engine.TEXTURE_NEAREST_LINEAR=7;Engine.TEXTURE_NEAREST_NEAREST=1;Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;Engine.TEXTURE_LINEAR_LINEAR=2;Engine.TEXTURE_LINEAR_NEAREST=12;Engine.TEXTURE_EXPLICIT_MODE=0;Engine.TEXTURE_SPHERICAL_MODE=1;Engine.TEXTURE_PLANAR_MODE=
2;Engine.TEXTURE_CUBIC_MODE=3;Engine.TEXTURE_PROJECTION_MODE=4;Engine.TEXTURE_SKYBOX_MODE=5;Engine.TEXTURE_INVCUBIC_MODE=6;Engine.TEXTURE_EQUIRECTANGULAR_MODE=7;Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;Engine.SCALEMODE_FLOOR=1;Engine.SCALEMODE_NEAREST=2;Engine.SCALEMODE_CEILING=3;Engine._RescalePostProcessFactory=null;Engine._RenderPassIdCounter=0}
//# sourceMappingURL=module$node_modules$$babylonjs$core$Engines$engine.js.map
